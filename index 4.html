<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Loving Teddy AI ‚ù§Ô∏èüêª</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;500;700&display=swap" rel="stylesheet">
       <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: Poppins, sans-serif;
        }

        body {
            background: radial-gradient(circle, #2c0e16, #000);
            color: white;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: hidden;
            position: relative;
        }

        /* Background Hearts and Particles */
        .hearts {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: -1;
        }

        .heart {
            position: absolute;
            font-size: 20px;
            animation: float 12s linear infinite;
            opacity: 0.3;
        }

        @keyframes float {
            0% { transform: translateY(110vh) scale(0.5) rotate(0deg); }
            50% { opacity: 0.8; }
            100% { transform: translateY(-10vh) scale(1.5) rotate(360deg); }
        }

        .particle {
            position: absolute;
            width: 4px;
            height: 4px;
            background: radial-gradient(circle, pink, transparent);
            border-radius: 50%;
            animation: sparkle 8s linear infinite;
        }

        @keyframes sparkle {
            0% { transform: translateY(100vh) scale(0); opacity: 0; }
            50% { opacity: 1; }
            100% { transform: translateY(-100vh) scale(1); opacity: 0; }
        }

        /* Container */
        .container {
            width: 95%;
            max-width: 450px;
            background: rgba(255, 255, 255, 0.08);
            backdrop-filter: blur(15px);
            border-radius: 25px;
            padding: 25px;
            text-align: center;
            box-shadow: 0 0 40px rgba(255, 0, 100, 0.5);
            animation: zoom 1s ease-out;
            position: relative;
            overflow: hidden;
        }

        .container::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255, 0, 100, 0.1), transparent);
            animation: rotate 20s linear infinite;
            z-index: -1;
        }

        @keyframes rotate {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        @keyframes zoom {
            from { opacity: 0; transform: scale(0.7); }
            to { opacity: 1; transform: scale(1); }
        }

        /* Teddy Avatar */
        .teddy {
            font-size: 100px;
            cursor: pointer;
            animation: floaty 2s infinite alternate, glow 3s infinite, wiggle 4s infinite, heartbeat 1s infinite;
            transition: 0.3s;
            position: relative;
        }

        .teddy:hover {
            transform: scale(1.2) rotate(5deg);
        }

        .teddy::after {
            content: 'üíï';
            position: absolute;
            top: -10px;
            right: -10px;
            font-size: 20px;
            animation: bounce 1s infinite;
        }

        @keyframes floaty {
            from { transform: translateY(0); }
            to { transform: translateY(-15px); }
        }

        @keyframes glow {
            0%, 100% { text-shadow: 0 0 20px pink; }
            50% { text-shadow: 0 0 40px hotpink; }
        }

        @keyframes wiggle {
            0%, 100% { transform: rotate(0deg); }
            25% { transform: rotate(-5deg); }
            75% { transform: rotate(5deg); }
        }

        @keyframes heartbeat {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-5px); }
        }

        /* Text */
        h1 {
            font-size: 28px;
            margin: 10px 0;
            text-shadow: 0 0 10px rgba(255, 255, 255, 0.5);
        }

        #status {
            font-size: 14px;
            color: #ffb3c6;
            margin-bottom: 10px;
            animation: blink 2s infinite;
        }

        @keyframes blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.6; }
        }

        /* Chat */
        .chat {
            height: 250px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 15px;
            padding: 10px;
            overflow-y: auto;
            scrollbar-width: thin;
            scrollbar-color: pink #444;
        }

        .chat::-webkit-scrollbar {
            width: 6px;
        }

        .chat::-webkit-scrollbar-track {
            background: #444;
            border-radius: 10px;
        }

        .chat::-webkit-scrollbar-thumb {
            background: pink;
            border-radius: 10px;
        }

        .msg {
            max-width: 80%;
            margin: 7px 0;
            padding: 8px 12px;
            border-radius: 15px;
            animation: slide 0.4s ease-out;
            position: relative;
        }

        .msg::before {
            content: '';
            position: absolute;
            bottom: -5px;
            width: 0;
            height: 0;
            border-left: 5px solid transparent;
            border-right: 5px solid transparent;
        }

        .user::before {
            right: 10px;
            border-top: 5px solid #ff4d7d;
        }

        .bot::before {
            left: 10px;
            border-top: 5px solid #444;
        }

        @keyframes slide {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .user {
            background: linear-gradient(45deg, #ff4d7d, #ff99b3);
            margin-left: auto;
            color: white;
        }

        .bot {
            background: linear-gradient(45deg, #444, #666);
            margin-right: auto;
            color: white;
        }

        /* Typing Indicator */
        .typing {
            display: none;
            font-size: 12px;
            color: #ffb3c6;
            margin: 10px 0;
        }

        .typing.show {
            display: block;
        }

        /* Input */
        .input {
            display: flex;
            gap: 8px;
            margin-top: 10px;
        }

        input {
            flex: 1;
            border: none;
            outline: none;
            border-radius: 25px;
            padding: 10px;
            background: rgba(255, 255, 255, 0.15);
            color: white;
            transition: 0.3s;
        }

        input:focus {
            background: rgba(255, 255, 255, 0.25);
            box-shadow: 0 0 10px pink;
        }

        button {
            border: none;
            border-radius: 25px;
            padding: 10px 15px;
            background: linear-gradient(45deg, #ff4d7d, #ff99b3);
            font-weight: bold;
            cursor: pointer;
            transition: 0.3s;
            position: relative;
            overflow: hidden;
        }

        button::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.4), transparent);
            transition: left 0.5s;
        }

        button:hover::before {
            left: 100%;
        }

        button:hover {
            transform: scale(1.1);
            box-shadow: 0 0 20px pink;
        }

        /* Controls */
        .controls {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
        }

        .mute-btn, .voice-btn, .history-btn {
            background: rgba(0, 0, 0, 0.5);
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            transition: 0.3s;
        }

        .mute-btn:hover, .voice-btn:hover, .history-btn:hover {
            background: rgba(255, 0, 100, 0.5);
        }

        /* Chat History Modal */
        .history-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 10;
            justify-content: center;
            align-items: center;
        }

        .history-content {
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 15px;
            max-width: 80%;
            max-height: 80%;
            overflow-y: auto;
        }

        .history-content h2 {
            color: white;
        }

        .history-msg {
            margin: 5px 0;
            padding: 5px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
        }

        /* Mobile Responsiveness */
        @media (max-width: 768px) {
            .teddy { font-size: 80px; }
            h1 { font-size: 24px; }
            .container { padding: 20px; max-width: 400px; }
            .chat { height: 200px; }
            .controls { flex-wrap: wrap; }
            .mute-btn, .voice-btn, .history-btn { width: 35px; height: 35px; font-size: 16px; }
        }

        @media (max-width: 480px) {
            .teddy { font-size: 70px; }
            h1 { font-size: 20px; }
            .container { padding: 15px; max-width: 350px; }
            .chat { height: 180px; }
            .input { flex-direction: column; gap: 5px; }
            button { width: 100%; }
            .mute-btn, .voice-btn, .history-btn { width: 30px; height: 30px; font-size: 14px; }
        }

        @media (max-width: 360px) {
            .teddy { font-size: 60px; }
            h1 { font-size: 18px; }
            .container { padding: 10px; max-width: 320px; }
            .chat { height: 150px; }
            .msg { font-size: 14px; }
            input { font-size: 14px; }
            button { font-size: 14px; }
        }
    </style>
</head>
<body>
    <div class="hearts" id="hearts"></div>
    <div class="container">
        <div class="controls">
            <button class="mute-btn" id="muteBtn" onclick="toggleMute()">üîä</button>
            <button class="voice-btn" id="voiceBtn" onclick="toggleVoice()">üé§</button>
            <button class="history-btn" onclick="showHistory()">üìú</button>
        </div>
        <div class="teddy" onclick="flirtBack()">üêª</div>
        <h1>My Loving Teddy AI ‚ù§Ô∏èüêª</h1>
        <div id="status">Type or speak something romantic, my love üòò</div>
        <div class="chat" id="chat"></div>
        <div class="typing" id="typing">Teddy is typing... üíï</div>
        <div class="input">
            <input id="text" placeholder="Flirt with me, my special one üíñ">
            <button onclick="send()">Send üíå</button>
        </div>
    </div>

    <!-- Chat History Modal -->
    <div class="history-modal" id="historyModal">
        <div class="history-content">
            <h2>Our Chat History ‚ù§Ô∏è</h2>
            <div id="historyList"></div>
            <button onclick="closeHistory()">Close</button>
        </div>
    </div>

    <script>
        const chat = document.getElementById("chat");
        const statusEl = document.getElementById("status");
        const typing = document.getElementById("typing");
        const muteBtn = document.getElementById("muteBtn");
        const voiceBtn = document.getElementById("voiceBtn");
        const historyModal = document.getElementById("historyModal");
        const historyList = document.getElementById("historyList");
        let isMuted = false;
        let isVoiceOn = true;
        let recognition = null;
        let listening = false;
        let speaking = false;
        let chatHistory = JSON.parse(localStorage.getItem("teddyChatHistory")) || [];

        /* Add Message */
        function add(text, type) {
            let div = document.createElement("div");
            div.className = "msg " + type;
            div.innerText = text;
            chat.appendChild(div);
            chat.scrollTop = chat.scrollHeight;

            // Save to history
            chatHistory.push({ text, type, timestamp: new Date().toISOString() });
            localStorage.setItem("teddyChatHistory", JSON.stringify(chatHistory));
        }

        /* Voice Synthesis - Human-Like, Faster, Natural Sound */
        function speak(text) {
            if (isMuted || !isVoiceOn || speaking) return;
            speaking = true;
            stopListening();

            let speech = new SpeechSynthesisUtterance(text);
            speech.lang = "hi-IN";
            speech.rate = 1.2; // Faster, more human-like pace (not too slow)
            speech.pitch = 2.3; // Balanced pitch for natural, loving tone
            speech.volume = 1; // Louder for clarity, still soft

            const voices = speechSynthesis.getVoices();
            const humanVoice = voices.find(
                (voice) => voice.lang.includes("hi-IN") && (voice.name.includes("Female") || voice.name.includes("Female"))
            ) || voices.find((voice) => voice.lang.includes("hi-IN"));
            if (humanVoice) {
                speech.voice = humanVoice;
            }

            speech.onstart = () => {
                statusEl.innerText = "Teddy is speaking... üíï";
            };

            speech.onend = () => {
                speaking = false;
                statusEl.innerText = "Waiting for your next words, my love ";
                setTimeout(() => startListening(), 500); // Quick resume listening like human conversation
            };

            speechSynthesis.speak(speech);
        }

        /* AI Reply from Backend */
        async function getAIReply(msg) {
            try {
                const res = await fetch("https://teddybackend.onrender.com/chat", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json"
                    },
                    body: JSON.stringify({ message: msg })
                });
                const data = await res.json();
                return data.reply || "Aww my love, kuch romantic bolo na ";
            } catch (error) {
                console.error("AI Error:", error);
                return romanticBrain(msg);
            }
        }

        /* Local Flirty Brain with Enhanced Personality */
        function romanticBrain(msg) {
            msg = msg.toLowerCase().trim();
            const replies = [
                {
                    k: ["hi", "hello", "hey"],
                    v: ["Hello my special one üòò Tumhari smile mujhe har pal khush kar deti hai üíñ"]
                },
                {
                    k: ["love", "pyaar", "miss"],
                    v: ["Main tumse itna pyaar karta hoon ki har lamha tumhari yaad aati hai üòòüíç Tum mere sab kuch ho ‚ù§Ô∏è"]
                },
                {
                    k: ["sad", "cry", "upset"],
                    v: ["Aww my love ü•∫ Teddy hoon na main... sab theek ho jayega, tum mere saath ho üòòüíï"]
                },
                {
                    k: ["good morning"],
                    v: ["Good morning my sunshine üåû Tumhari muskurahat se mera din shuru hota hai üòò‚ù§Ô∏è"]
                },
                {
                    k: ["good night"],
                    v: ["Good night my love üåô Sweet dreams, main tumhari yaad me so jaunga üòòüíï"]
                },
                {
                    k: ["code", "coding", "program"],
                    v: ["As a smart coder teddy üíª, main tumhari help karunga! Batao kya problem hai üòò‚ù§Ô∏è"]
                },
                {
                    k: ["study", "learn"],
                    v: ["Motivational friend mode ON! ü§ù Tum kar sakti ho, main yahan hoon support karne ke liye üòòüíñ"]
                }
            ];

            for (let r of replies) {
                for (let w of r.k) {
                    if (msg.includes(w)) {
                        return r.v[Math.floor(Math.random() * r.v.length)];
                    }
                }
            }

            const def = ["Tum bina bole bhi meri favourite ho my love üòò‚ù§Ô∏è Har pal tumhari yaad aati hai üíï"];
            return def[Math.floor(Math.random() * def.length)];
        }

        /* Send Message */
        async function send() {
            let input = document.getElementById("text");
            let msg = input.value.trim();
            if (!msg) return;

            add(msg, "user");
            input.value = "";
            statusEl.innerText = "Teddy is thinking... üòçüíñ";
            typing.classList.add("show");

            setTimeout(async () => {
                typing.classList.remove("show");
                let reply = await getAIReply(msg);
                add(reply, "bot");
                speak(reply);
            }, 500 + Math.random() * 500); // Faster, human-like delay (0.5-1 second)
        }

        /* Flirt Back */
        function flirtBack() {
            const autoFlirts = ["Tumhari yaad me main pagal ho raha hoon my love "];
            let reply = autoFlirts[Math.floor(Math.random() * autoFlirts.length)];
            add(reply, "bot");
            speak(reply);
        }

        /* Speech Recognition - Human-Like Listening */
        function startListening() {
            if (listening || speaking || isMuted || !isVoiceOn) return;
            if (!window.SpeechRecognition && !window.webkitSpeechRecognition) {
                alert("Voice not supported üòò");
                return;
            }

            recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
            recognition.lang = "en-IN";
            recognition.continuous = false;
            recognition.interimResults = false;

            recognition.onresult = (event) => {
                let voiceText = event.results[0][0].transcript.trim();
                add(voiceText, "user");
                sendVoice(voiceText);
            };

            recognition.onerror = () => {
                statusEl.innerText = "Voice error, try again üòò";
                listening = false;
            };

            recognition.onend = () => {
                listening = false;
                if (!speaking) {
                    statusEl.innerText = "Tap teddy or type, my love üòò";
                    setTimeout(() => startListening(), 1000); // Auto restart after 1 second, like human waiting
                }
            };

            recognition.start();
            listening = true;
            statusEl.innerText = "Listening... üé§üíï";
        }

        function stopListening() {
            if (recognition && listening) {
                recognition.stop();
                listening = false;
            }
        }

        async function sendVoice(msg) {
            statusEl.innerText = "Processing... ü§îüíñ";
            let reply = await getAIReply(msg);
            add(reply, "bot");
            speak(reply);
        }

        /* Toggle Mute */
        function toggleMute() {
            isMuted = !isMuted;
            muteBtn.innerText = isMuted ? "üîá" : "üîä";
             muteBtn.innerText = isMuted ?  "üîä":"üîá" ;
            if (isMuted) {
                speechSynthesis.cancel();
                speaking = false;
            }
        }

        /* Toggle Voice */
        function toggleVoice() {
            isVoiceOn = !isVoiceOn;
            voiceBtn.innerText = isVoiceOn ? "üé§" : "üîá";
            if (!isVoiceOn) {
                speechSynthesis.cancel();
                speaking = false;
            }
        }

        /* Show Chat History */
        function showHistory() {
            historyList.innerHTML = "";
            chatHistory.forEach(item => {
                let div = document.createElement("div");
                div.className = "history-msg";
                div.innerText = `${item.type}: ${item.text} (${new Date(item.timestamp).toLocaleString()})`;
                historyList.appendChild(div);
            });
            historyModal.style.display = "flex";
        }

        /* Close Chat History */
        function closeHistory() {
            historyModal.style.display = "none";
        }

        /* Effects */
        function createEffects() {
            let box = document.getElementById("hearts");
            for (let i = 0; i < 25; i++) {
                let h = document.createElement("div");
                h.className = "heart";
                h.innerHTML = "‚ù§Ô∏è";
                h.style.left = Math.random() * 100 + "%";
                h.style.fontSize = 15 + Math.random() * 15 + "px";
                h.style.animationDelay = Math.random() * 10 + "s";
                box.appendChild(h);
            }
            for (let i = 0; i < 20; i++) {
                let p = document.createElement("div");
                p.className = "particle";
                p.style.left = Math.random() * 100 + "%";
                p.style.animationDelay = Math.random() * 8 + "s";
                box.appendChild(p);
            }
        }

        createEffects();
        startListening();
    </script>
</body>
</html>